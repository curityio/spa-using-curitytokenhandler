<config xmlns="http://tail-f.com/ns/config/1.0">
  <environments xmlns="https://curity.se/ns/conf/base">
    <environment>
      <admin-service>
        <http>
          <ssl-server-keystore>default-admin-ssl-key</ssl-server-keystore>
          <web-ui/>
          <restconf>
          </restconf>
        </http>
      </admin-service>
      <services>
        <zones>
          <default-zone>
            <symmetric-key>#{SYMMETRIC_KEY}</symmetric-key>
          </default-zone>
        </zones>
        <service-role>
          <id>default</id>
          <protocol>http</protocol>
          <endpoints>apps-tokenhandler</endpoints>
        </service-role>
      </services>
    </environment>
  </environments>
  <profiles xmlns="https://curity.se/ns/conf/base">
    <profile>
      <id>tokenhandler</id>
      <type xmlns:apps="https://curity.se/ns/conf/profile/apps">apps:apps-service</type>
      <expose-detailed-error-messages/>
      <settings>
        <apps-service xmlns="https://curity.se/ns/conf/profile/apps">
          <applications>
            <application>
              <id>example</id>
              <token-handler xmlns="https://curity.se/ns/conf/apps/tokenhandler">
                <single-page-application-base-url>http://www.product.example</single-page-application-base-url>
                <external-client>
                  <client-id>spa-client</client-id>
                  <client-secret>xyNcensqT1FG0Zs0CMQtC1dDW1Vw1Luz</client-secret>
                  <scope>openid</scope>
                  <scope>profile</scope>
                  <authorization-endpoint>http://login.example.com/realms/example/protocol/openid-connect/auth</authorization-endpoint>
                  <token-endpoint>http://login-internal:8080/realms/example/protocol/openid-connect/token</token-endpoint>
                  <logout>
                    <logout-endpoint>http://login.example.com/realms/example/protocol/openid-connect/logout</logout-endpoint>
                    <post-logout-redirect-uri>http://www.product.example/</post-logout-redirect-uri>
                  </logout>
                  <token-issuer>http://login.example.com/realms/example</token-issuer>
                  <redirect-uri>http://www.product.example/callback</redirect-uri>
                </external-client>
                <proxy-keystore>
                  <id>oauth-agent-example-publickey</id>
                </proxy-keystore>
                <cookie-prefix>th-</cookie-prefix>
                <require-custom-header>true</require-custom-header>
                <proxy-type>#{OAUTH_PROXY_TYPE}</proxy-type>
              </token-handler>
            </application>
          </applications>
        </apps-service>
      </settings>
      <endpoints>
        <endpoint>
          <id>apps-tokenhandler</id>
          <uri>/oauthagent</uri>
          <endpoint-kind>apps-anonymous</endpoint-kind>
        </endpoint>
      </endpoints>
    </profile>
  </profiles>
  <facilities xmlns="https://curity.se/ns/conf/base">
    <crypto>
      <encryption-keys>
        <encryption-key>
          <id>oauth-agent-example-publickey</id>
          <curve-name>P-256</curve-name>
          <keystore>#{TH_COOKIE_CERT}</keystore>
          <type>elliptic-curve</type>
          <external-id>oauth-agent-example-publickey</external-id>
        </encryption-key>
      </encryption-keys>
      <ssl>
        <server-keystore>
          <id>default-admin-ssl-key</id>
          <keystore>data:application/p12;aes,v:S.MEZVOVcwWkhDREt0bHpiQw==.4yXBSNbN0NDnuzR_uRmiVw==.SGcMGndVvl7ztgHaDRHyjrfPwsSTVzm9H66G1Yp_X1iDyxzNbyyt9Xx0HftJLCis5e9MlADlZdwxKjST3ialG6CCD18Ty8Jf9NJAhRTlQOFJY2VXwA1W40-1a3bSWFexMI9V1g5NV3rfkc9zYQj6WJhj8uyM4U7ORyNwoC_Q7HIpKPEORWgGeiim_R004PEsuJMOxi8JdVbDI9Y8rzKzMXjJCd8QPpnhKQw1PQULWhou5eSjluTIknFeXtoN9xrzDMLAkTO1he46gKgY3Q7AylosGxHAITjma_aU00iz0TBBcXkmsqlV8jnYV6rVroGzz19XnZNNeHCDhSekdgKb9R6H-k4NoKclQHfyVSOez9YnJMTcV5jJDdwOhu6LCXelbsS9sRDSpAYq7DwGnL8a-Lndp_g_csmF53u-voSk7L924Toy32E565CnXdwQ7oqGLanVeVDZOr-B-xKHIBPwtVWM_WhpO2CbxtsF39MGUQfD-x0_cdeaCg6OWJPbUtKBm6QZE5v2G0MsXBnc988Me3889DZve7NTJzGxBHfLIG0k2yG1TkhntZmA_lY9Elf7gaIIxVjXKoXYccFqOVHbC7-XXaI-p6EsrmYyLSJqMrXIFQuNxvTMfqNrCqU8RkEr_TJBPsCSWUdsuXKIpGZzqczt1sGoXvwhhiB9gOjshliL7YVU1DiKdOi-mIWnNEJOo3_ha45JxrM6uXWdgmC_sJ0wrsz2uHSdsCdVKaLBu04HzUgRwSNELJxTkE_txabdfROWndbLHFRVl8o1qoZRKhgeMHTCLMXEasxysVcyYMkyoD2EUC16rh2XyyFpw2ukJmCuRwZGaGWid0Bsvj9rvxakqNVVCdWOdKEttXMxCVPrAp-zGU2Tv64Ok6AdT4qadoq9B6wuwMt8wc__LM9mGQnOtcGfNO5ZI22fA3oP7Ba-iA1HoTgL86_L8WYeVWNUz0coAm-rtseJHWw-kBoIv47XSg4f4zlQuhJA8pCT9VBN8cBQuC2FHHmSAgewnan2Ywm9mqXK3wh89-HNzgks12XOq72NNc3zEAnnLWZNWo5o7_NJ31x7UhWQIDPeBmz-ArL_9ABbIO-CQLEd4IT33RWPieZk60pIgpkVUUiQqDz26iDMEtS1-PRHwBakmJhyiNky_HWNlce7OxVwooi--bG8j5-Wy7xRh1dS4kOAVphVZ4Cc8w7s5dsDDmRbsI8BTbGUZ009PZzagi8BFMThMa0fPup-qVUly6rC5xGYtO0zqVzLuRkLCDe_MTc1cPN9Xc3_0oQFr8z3HZx8OWsa9gdd1Ed6qmvcthxjI2APlsqXsSJE2Fmbd4YQX_JWetneN5g73jS29fZfER3ZufQOHBWBSAYeJhF7bscurH1VrCPHStX6k4eEwSJ1-xgJOGYo7oIvFj0Lmklrp2VjxwDFxCaNWH-FIcZAFaUMsCQTZeRoUW2_0TcoZyEJwVyadeYKo1IoI5DRzhbZOi0-uCw4gF-ah80E5zALUfUKyZcM0BVo3fchXmXVpzyg6H4HoUZrKXW8GMJeNxiVwoqz_MlBPAeEzcUA_L0WBZF1Qp9X3RDIIgLpnDNXg3xtBdqBTmK7vbkT0Xqml3UcYmF0Siw-L37UnRD98A0LnHUcx1bWORAbH5zR7N27kPCOnxLorSEbsdynnqqSN2RwHvMsPDZgvSMCfId6pWgHCWTRZXsa4nDRzWULyfojq1huRWXKrpdHjMWpVI5fSxbg8XEimHVtIcG9f--wEkw1zo7rtl-KetaJQyHlatXhwSLW6b1YbUmqfQ3V-tOGJ8q3ZrBdW-S-R23ag9M4EJBJKeU5Iaa9svnYoIG1Cv0kpH3AJOXRytuMvdfc7tU28ps65A5SJrbbhtMS7SvuVSN9_OhpaooxK9phwcIZGd7-sGxLR309Jpb7WJAnVQZu_FRtAtSHKcc3bFqAdGFDXaWsGlcD4sGBNOVIdUWvMcLPQZmwpgnjz6dkGOCNI11pZYOZKDo4-qnoC0Goiws3p5u7sVhZcPzq6Ony6XTpe21dvZ3n7WFbQxJ7_Le_8xGTNdqtzfEQKhbHay0u-646qfwKr2UqCz4zMvae4HuymIa8Pp8i9r3pFtF9LX6micxHc8CCNdPwE_F-X_b5Ew9ejvzL1eodMEnkhfCm5uqjsGyJZohgaoiE3nEK_vpI_pYNJELQuyZy-3Qu7WgUGp_i0stf11lyuPSzGb8YDBSi_hGduDHdswoTv7PPATarZn11JsUbpaIwiUsZX3De_hB8RIro1VWxGmLdQN5h33trx6m_Q4M_1lL-ChiECq6VBrAG6uo8Ki-iUZRciK8cv3kmTO7saRrtF3bMhuXGOBAI-NTNfd5gK94oFRoEiO1jhuStXTtlrRszyZImk-FPVLB-7FldbR5sxO3IXbFpd-BFrHS_hpXFag__eIgpRSefdpuSJF6mpsfYnXsGSWeIfGkSp0YCVaeedwa3gyUT1AKrQ_Cvjy-OM5sNIOIY39E0wMHgx5_G4YE9WbipVtEjYrCTKCi4hk_Isn-YL6DJNwhcVXnEPJ0t-mGSffD6fInyzkNqrK-FAGKNls7Ij29PoZNpxXlUlMioVtjNJd9iZRYZarW_eIt34R4__pxbRjHgccdW_iXgaAGPkEzldo2f67cN11teaDcwa-3t0HCKwHkg7cPrzyl9HS1Oj9Qh8xRPU4-KqbCiD5X7opFmLgnuT7j9yGTa029qRQAhfNoDIbBJ3On-rBYsfFdcB2JtZtSLDuz5E_wTERLPQOOaDJcqBq83b3F4ryp1ZOvBVQ3Tt9vYNDu8HlEe_y-QXHNxgbQVr94ZCvkufU4zFI7ZZqtQWEQwQm-4eVOyXERvSBK6mwcxLvXzjJmUHJKm11GOw9M94-QnJb-1Xu3R5w41c6MhfZYOuAUL2llx70q1I3QzDSCcsQLwGwqyAGwtI1tScU1F7muTHqrjzLXQzBIq9GWwqOewFzol7nl_bU72uB9fdKLE5BMGJBVsJDqbcCbgx86Fph7RNhJhMKzVUa396nFZBMMdur7fZs3xFyEHu9UJfVDm_v8lcgsgHIC1f1OLGULdfR7BgLrLOZsS3GBd0r8eI7M-tsaVYvDGpYw-sgunes-Lr_KA2icp6wuThbC_LlDNplTugSk_QIavb9gQfkWO5rioS23DfblmijxUWAigyAHiV4RL-Vq5h30Kk5bDrRuzUUmb6SNNTd_ViVIxu-LPS48_nIqwqYHUxcZDND7j1Pi-Hn_TzvKVTDBgXZ4_PNY29LuRL5gFTeTfWkbnp5CIGsj6Gk1wGvn14HGzZgqbpVYF_wQR3I54kzvnvzY_oV9bcVLi6_4qucCgBIcZBXiAHRid2T96M0cHPo_DLU_tHyxPYrzmiSDjsFUBn0cwHi-sox_NSJTN1o1RkiQ45ZsGHtyLQWMXUG3zFcET57E=.WiwcPSv-Jw9A74NxEZLzwok5WZG5Y1hJPhDoZGr4s5o=</keystore>
        </server-keystore>
      </ssl>
    </crypto>
  </facilities>
  <processing xmlns="https://curity.se/ns/conf/base">
    <license-key></license-key>
  </processing>
  <nacm xmlns="urn:ietf:params:xml:ns:yang:ietf-netconf-acm">
    <write-default>permit</write-default>
    <groups>
      <group>
        <name>admin</name>
        <user-name>admin</user-name>
      </group>
    </groups>
    <rule-list>
      <name>admin</name>
      <group>admin</group>
      <rule>
        <name>any-access</name>
        <action>permit</action>
      </rule>
    </rule-list>
    <rule-list>
      <name>any-group</name>
      <group>*</group>
      <rule>
        <name>tailf-aaa-authentication</name>
        <module-name>tailf-aaa</module-name>
        <path>/aaa/authentication/users/user[name='$USER']</path>
        <access-operations>read update</access-operations>
        <action>permit</action>
      </rule>
      <rule>
        <name>tailf-aaa-user</name>
        <module-name>tailf-aaa</module-name>
        <path>/user[name='$USER']</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
      </rule>
      <rule>
        <name>tailf-webui-user</name>
        <module-name>tailf-webui</module-name>
        <path>/webui/data-stores/user-profile[username='$USER']</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
      </rule>
    </rule-list>
  </nacm>
  <aaa xmlns="http://tail-f.com/ns/aaa/1.1">
    <authentication>
      <users>
        <user>
          <name>admin</name>
          <uid>0</uid>
          <gid>0</gid>
          <password>$5$9u6hliDa$bfX4eju/Dm4VpI7RjQMpvCjcvJxJCkzT6B8OY2iXuzB</password>
          <ssh_keydir>/opt/idsvr/home/admin/.ssh</ssh_keydir>
          <homedir>/opt/idsvr/home/admin</homedir>
        </user>
      </users>
    </authentication>
    <ios>
      <level>
        <nr>0</nr>
        <prompt>\h> </prompt>
      </level>
      <level>
        <nr>15</nr>
        <prompt>\h# </prompt>
      </level>
      <privilege>
        <mode>exec</mode>
        <level>
          <nr>0</nr>
          <command>
            <name>action</name>
          </command>
          <command>
            <name>autowizard</name>
          </command>
          <command>
            <name>enable</name>
          </command>
          <command>
            <name>exit</name>
          </command>
          <command>
            <name>help</name>
          </command>
          <command>
            <name>startup</name>
          </command>
        </level>
        <level>
          <nr>15</nr>
          <command>
            <name>configure</name>
          </command>
        </level>
      </privilege>
    </ios>
  </aaa>
</config>